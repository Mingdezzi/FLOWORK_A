{% extends 'base.html' %}

{% block content %}
<div class="container-fluid p-0">
    
    {% if error %}
    <div class="alert alert-danger rounded-0 mb-4 shadow-sm">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>대시보드 로드 중 오류 발생: {{ error }}
    </div>
    {% endif %}

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card h-100 rounded-0 border shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-megaphone-fill me-2 text-danger"></i>공지사항</h5>
                    <a href="{{ url_for('ui.announcement_list') }}" class="btn btn-sm btn-outline-secondary rounded-0 px-3">더보기</a>
                </div>
                <ul class="list-group list-group-flush">
                    {% if recent_announcements %}
                        {% for item in recent_announcements %}
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3 border-bottom-0">
                            <a href="{{ url_for('ui.announcement_detail', id=item.id) }}" class="text-decoration-none text-dark text-truncate fw-bold" style="max-width: 70%;">
                                {{ item.title }}
                            </a>
                            <span class="badge bg-light text-muted border rounded-0">{{ item.created_at.strftime('%Y-%m-%d') }}</span>
                        </li>
                        {% endfor %}
                    {% else %}
                        <li class="list-group-item text-center text-muted p-5">등록된 공지사항이 없습니다.</li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100 rounded-0 border shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-calendar-week-fill me-2 text-success"></i>이번 주 일정</h5>
                    <a href="{{ url_for('ui.schedule') }}" class="btn btn-sm btn-outline-secondary rounded-0 px-3">전체보기</a>
                </div>
                <ul class="list-group list-group-flush">
                    {% if weekly_schedules %}
                        {% for event in weekly_schedules %}
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3 border-bottom-0">
                            <div class="text-truncate">
                                <span class="badge rounded-0 me-2" style="background-color: {{ event.color }};">{{ event.event_type }}</span>
                                <strong class="text-dark">{{ event.title }}</strong>
                                <small class="text-muted ms-1">({{ event.staff.name if event.staff else '전체' }})</small>
                            </div>
                            <small class="text-muted flex-shrink-0 ms-2 bg-light px-2 py-1 border">
                                {{ event.start_time.strftime('%m-%d') }}
                                {% if event.end_time and event.end_time.date() != event.start_time.date() %}
                                    ~ {{ event.end_time.strftime('%m-%d') }}
                                {% endif %}
                            </small>
                        </li>
                        {% endfor %}
                    {% else %}
                        <li class="list-group-item text-center text-muted p-5">이번 주 일정이 없습니다.</li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <div class="col-12">
            <div class="card rounded-0 border shadow-sm mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-box-seam-fill me-2 text-primary"></i>진행 중인 주문</h5>
                    <a href="{{ url_for('ui.order_list') }}" class="btn btn-sm btn-outline-secondary rounded-0 px-3">더보기</a>
                </div>
                <div class="card-body p-0">
                    {% if pending_orders %}
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0 text-center">
                            <thead class="table-light">
                                <tr>
                                    <th>일자</th>
                                    <th>고객명</th>
                                    <th>상품명</th>
                                    <th>상태</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in pending_orders %}
                                <tr onclick="window.location='{{ url_for('ui.order_detail', order_id=order.id) }}';" style="cursor: pointer;">
                                    <td>{{ order.created_at.strftime('%m-%d') }}</td>
                                    <td class="fw-bold">{{ order.customer_name }}</td>
                                    <td class="text-start ps-4 text-truncate" style="max-width: 300px;">
                                        {{ order.product_name }}
                                        <span class="text-muted small ms-1">({{ order.product_number }})</span>
                                    </td>
                                    <td><span class="badge bg-info text-dark rounded-0">{{ order.order_status }}</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <div class="p-5 text-center text-muted">진행 중인 주문이 없습니다.</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}