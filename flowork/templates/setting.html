<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>설정</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/journal/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body data-api-stores-url="{{ url_for('admin.api_get_stores') }}"
      data-api-stores-add-url="{{ url_for('admin.api_add_store') }}"
      data-api-store-update-url-prefix="{{ url_for('admin.api_update_store', sid=0)[:-1] }}"
      data-api-store-delete-url-prefix="{{ url_for('admin.api_delete_store', sid=0)[:-1] }}"
      data-api-brand-name-set-url="{{ url_for('admin.api_update_brand_name') }}"
      data-api-load-settings-url="{{ url_for('admin.api_load_settings') }}"
      data-api-setting-url="{{ url_for('admin.api_update_setting') }}"
      data-api-staff-add-url="{{ url_for('admin.api_add_staff') }}"
      data-api-staff-update-url-prefix="{{ url_for('admin.api_update_staff', sid=0)[:-1] }}"
      data-api-staff-delete-url-prefix="{{ url_for('admin.api_delete_staff', sid=0)[:-1] }}"
      data-api-store-approve-url-prefix="{{ url_for('admin.api_approve_store', sid=0)[:-1] }}"
      data-api-store-toggle-active-url-prefix="{{ url_for('admin.api_toggle_store', sid=0)[:-1] }}"
      data-api-store-reset-url-prefix="{{ url_for('admin.api_reset_store', sid=0)[:-1] }}">
    
    <div class="container my-4">
        {% include '_header.html' %}
        {% include '_navigation.html' %}

        <h2 class="section-title">설정</h2>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert {{ 'alert-success' if category == 'success' else 'alert-danger' }} alert-dismissible fade show">
                    {{ message }} <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        <div class="mb-4">
            {% if not current_user.store_id %}
            <div class="card mb-3">
                <div class="card-header">브랜드 설정</div>
                <div class="card-body">
                    <form id="form-brand-name" class="input-group mb-3">
                        <span class="input-group-text">브랜드명</span>
                        <input type="text" class="form-control" id="brand-name-input" value="{{ brand_name }}">
                        <button class="btn btn-primary" type="submit" id="btn-save-brand-name">저장</button>
                    </form>
                    <div id="brand-name-status"></div>
                    <hr>
                    <button class="btn btn-info btn-sm" id="btn-load-settings">설정 파일 로드</button>
                    <div id="load-settings-status" class="mt-2"></div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header">매장 관리</div>
                <div class="card-body">
                    <form id="form-add-store" class="row g-2 mb-3">
                        <div class="col-md-4"><input type="text" class="form-control" id="new_store_code" placeholder="코드"></div>
                        <div class="col-md-4"><input type="text" class="form-control" id="new_store_name" placeholder="이름"></div>
                        <div class="col-md-3"><input type="text" class="form-control" id="new_store_phone" placeholder="연락처"></div>
                        <div class="col-md-1"><button class="btn btn-success w-100" type="submit" id="btn-add-store">+</button></div>
                    </form>
                    <div id="add-store-status"></div>
                    <div class="table-responsive">
                        <table class="table table-sm table-hover" id="all-stores-table">
                            <thead><tr><th>코드</th><th>이름</th><th>연락처</th><th>상태</th><th>작업</th></tr></thead>
                            <tbody>
                                {% for s in all_stores %}
                                <tr id="store-row-{{ s.id }}">
                                    <td data-field="code">{{ s.store_code }}</td>
                                    <td data-field="name">{{ s.store_name }}</td>
                                    <td data-field="phone">{{ s.phone_number }}</td>
                                    <td>{{ '활성' if s.is_active else '비활성' }}</td>
                                    <td><button class="btn btn-sm btn-danger btn-delete-store" data-id="{{ s.id }}" data-name="{{ s.store_name }}">삭제</button></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div id="delete-store-status"></div>
                </div>
            </div>
            {% endif %}

            {% if current_user.store_id %}
            <div class="card mb-3">
                <div class="card-header">직원 관리</div>
                <div class="card-body">
                    <form id="form-add-staff" class="row g-2 mb-3">
                        <div class="col-md-4"><input type="text" class="form-control" id="new_staff_name" placeholder="이름"></div>
                        <div class="col-md-3"><input type="text" class="form-control" id="new_staff_position" placeholder="직책"></div>
                        <div class="col-md-4"><input type="text" class="form-control" id="new_staff_contact" placeholder="연락처"></div>
                        <div class="col-md-1"><button class="btn btn-success w-100" type="submit" id="btn-add-staff">+</button></div>
                    </form>
                    <div id="add-staff-status"></div>
                    <div class="table-responsive">
                        <table class="table table-sm" id="all-staff-table">
                            <thead><tr><th>이름</th><th>직책</th><th>연락처</th><th>작업</th></tr></thead>
                            <tbody>
                                {% for s in staff_list %}
                                <tr id="staff-row-{{ s.id }}">
                                    <td data-field="name">{{ s.name }}</td>
                                    <td data-field="position">{{ s.position }}</td>
                                    <td data-field="contact">{{ s.contact }}</td>
                                    <td><button class="btn btn-sm btn-danger btn-delete-staff" data-id="{{ s.id }}" data-name="{{ s.name }}">삭제</button></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div id="delete-staff-status"></div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/setting.js') }}"></script>
</body>
</html>