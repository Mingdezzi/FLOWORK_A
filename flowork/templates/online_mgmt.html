{% extends 'base.html' %}

{% block body_attrs %}
data-api-list="{{ url_for('api.get_product_image_status') }}" 
data-api-process="{{ url_for('api.trigger_image_process') }}"
data-api-options="{{ url_for('api.get_user_options') }}"
data-api-task-status-prefix="/api/task_status/"
data-api-folder-prefix="/api/product/folder/"
data-api-logo-upload="{{ url_for('api.upload_brand_logo') }}"
{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="section-title mb-0"><i class="bi bi-globe me-2"></i>온라인 품번 관리</h2>
        <div class="d-flex gap-2">
            <button class="btn btn-warning text-dark" id="btn-reset-selection" disabled>
                <i class="bi bi-arrow-counterclockwise me-1"></i> 선택 초기화
            </button>
            <button class="btn btn-primary" id="btn-start-process" disabled>
                <i class="bi bi-play-fill me-1"></i> 처리 시작
            </button>
        </div>
    </div>

    <div class="options-panel">
        <div class="row g-3 align-items-end">
            <div class="col-auto">
                <label for="opt-padding">안전 여백 (px)</label>
                <input type="number" class="form-control form-control-sm" id="opt-padding" value="10" min="0" max="200" style="width: 100px;">
            </div>
            <div class="col-auto">
                <label for="opt-direction">배치 방향</label>
                <select class="form-select form-select-sm" id="opt-direction" style="width: 140px;">
                    <option value="SE" selected>↘ 우하단 (기본)</option>
                    <option value="SW">↙ 좌하단</option>
                    <option value="NE">↗ 우상단</option>
                    <option value="NW">↖ 좌상단</option>
                    <option value="E">→ 우측</option>
                    <option value="W">← 좌측</option>
                    <option value="S">↓ 하단</option>
                    <option value="N">↑ 상단</option>
                </select>
            </div>
            <div class="col-auto">
                <label for="opt-bgcolor">배경 색상</label>
                <div class="input-group input-group-sm">
                    <input type="color" class="form-control form-control-color" id="opt-bgcolor-picker" value="#FFFFFF" title="색상 선택">
                    <input type="text" class="form-control" id="opt-bgcolor-text" value="#FFFFFF" style="width: 90px; text-transform: uppercase;">
                </div>
            </div>
            <div class="col-auto border-start ps-3">
                <label for="opt-logo-align">로고 위치</label>
                <select class="form-select form-select-sm" id="opt-logo-align" style="width: 120px;">
                    <option value="left" selected>좌측 상단</option>
                    <option value="center">중앙 상단</option>
                    <option value="right">우측 상단</option>
                </select>
            </div>
            <div class="col-auto">
                <label for="logo-file">로고 파일 등록</label>
                <div class="input-group input-group-sm">
                    <input type="file" class="form-control" id="logo-file" accept="image/png, image/jpeg">
                    <button class="btn btn-outline-secondary" type="button" id="btn-upload-logo">업로드</button>
                </div>
            </div>
        </div>
    </div>

    <div id="progress-container" class="mb-4" style="display: none;">
        <div class="d-flex justify-content-between mb-1">
            <span class="fw-bold text-primary">작업 진행 중...</span>
            <span id="progress-text" class="small text-muted">0% (0/0)</span>
        </div>
        <div class="progress" style="height: 20px;">
            <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-primary" role="progressbar" style="width: 0%"></div>
        </div>
    </div>

    <div class="card mb-4 border-primary">
        <div class="card-header bg-white">
            <div class="d-flex align-items-center justify-content-between">
                <h5 class="mb-0 text-primary">현재 작업 목록</h5>
                <button class="btn btn-sm btn-outline-danger" id="btn-clear-current-batch" style="display:none;">목록 비우기</button>
            </div>
            <ul class="nav nav-tabs card-header-tabs mt-3" id="currentBatchTabs" role="tablist">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-current-ready" data-tab-type="ready" data-scope="current">대기 <span class="badge bg-secondary rounded-pill ms-1" id="cnt-current-ready">0</span></button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-current-processing" data-tab-type="processing" data-scope="current">진행중 <span class="badge bg-primary rounded-pill ms-1" id="cnt-current-processing">0</span></button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-current-completed" data-tab-type="completed" data-scope="current">완료 <span class="badge bg-success rounded-pill ms-1" id="cnt-current-completed">0</span></button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-current-failed" data-tab-type="failed" data-scope="current">실패 <span class="badge bg-danger rounded-pill ms-1" id="cnt-current-failed">0</span></button></li>
            </ul>
        </div>
        <div class="card-body p-0">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-current-ready"><div class="table-responsive" id="table-current-ready"></div></div>
                <div class="tab-pane fade" id="tab-current-processing"><div class="table-responsive" id="table-current-processing"></div></div>
                <div class="tab-pane fade" id="tab-current-completed"><div class="table-responsive" id="table-current-completed"></div></div>
                <div class="tab-pane fade" id="tab-current-failed"><div class="table-responsive" id="table-current-failed"></div></div>
            </div>
        </div>
    </div>

    <div class="section-divider"></div>

    <div class="card">
        <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0">전체 이력 관리</h5>
                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#advancedSearchBox"><i class="bi bi-sliders"></i> 상세 검색</button>
            </div>
            <div class="collapse show" id="advancedSearchBox">
                <div class="card card-body bg-white mb-3 p-3 border">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold small">다중 품번 검색</label>
                            <textarea class="form-control form-control-sm" id="search-multi-codes" rows="4" placeholder="품번을 줄바꿈(Enter)으로 구분"></textarea>
                        </div>
                        <div class="col-md-8">
                            <div class="row g-2">
                                <div class="col-md-6"><label class="form-label fw-bold small">품명</label><input type="text" class="form-control form-control-sm" id="search-name"></div>
                                <div class="col-md-3"><label class="form-label fw-bold small">연도</label><select id="search-year" class="form-select form-select-sm"><option value="">전체</option>{% for year in filter_options.years %}<option value="{{ year }}">{{ year }}</option>{% endfor %}</select></div>
                                <div class="col-md-3"><label class="form-label fw-bold small">카테고리</label><select id="search-category" class="form-select form-select-sm"><option value="">전체</option>{% for cat in filter_options.categories %}<option value="{{ cat }}">{{ cat }}</option>{% endfor %}</select></div>
                                <div class="col-12 d-flex align-items-end justify-content-end gap-2 mt-3">
                                    <button class="btn btn-secondary btn-sm" id="btn-search-reset">초기화</button>
                                    <button class="btn btn-primary btn-sm w-25" id="btn-search-exec">검색</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <ul class="nav nav-tabs card-header-tabs mt-2" id="historyTabs" role="tablist">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-hist-all" data-tab-type="all" data-scope="history">전체목록</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-hist-completed" data-tab-type="completed" data-scope="history">완료목록</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-hist-failed" data-tab-type="failed" data-scope="history">실패목록</button></li>
            </ul>
        </div>
        <div class="card-body p-0">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="tab-hist-all"><div class="table-responsive" id="table-hist-all"></div><div class="p-2 border-top d-flex justify-content-center" id="page-hist-all"></div></div>
                <div class="tab-pane fade" id="tab-hist-completed"><div class="table-responsive" id="table-hist-completed"></div><div class="p-2 border-top d-flex justify-content-center" id="page-hist-completed"></div></div>
                <div class="tab-pane fade" id="tab-hist-failed"><div class="table-responsive" id="table-hist-failed"></div><div class="p-2 border-top d-flex justify-content-center" id="page-hist-failed"></div></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="imagePreviewModal" tabindex="-1"><div class="modal-dialog modal-lg modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">이미지 미리보기</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body p-0"><div class="modal-img-container"><img id="preview-image-target" src=""></div></div></div></div></div>
<div class="modal fade" id="folderViewModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">폴더 파일 목록</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div id="folder-list-container" class="list-group list-group-flush"></div></div></div></div></div>

<template id="table-template">
    <table class="table table-hover align-middle mb-0 text-center">
        <thead class="table-light"><tr><th style="width: 40px;"><input type="checkbox" class="form-check-input check-all"></th><th>품번</th><th>품명</th><th>컬러수</th><th>썸네일</th><th>상세컬러</th><th>전체이미지</th><th>상태</th><th>관리</th></tr></thead>
        <tbody></tbody>
    </table>
</template>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/online_mgmt.js') }}"></script>
{% endblock %}